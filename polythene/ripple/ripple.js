"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var _polythenePolythenePolythene=require("polythene/polythene/polythene");var _polythenePolythenePolythene2=_interopRequireDefault(_polythenePolythenePolythene);var _mithril=require("mithril");var _mithril2=_interopRequireDefault(_mithril);require("polythene-theme/ripple/ripple");var DEFAULT_START_OPACITY=.2;var OPACITY_DECAY_VELOCITY=.35;var tapStart=undefined,tapEnd=undefined,tapListeners=undefined;tapListeners=[];var initTapEvents=function initTapEvents(el,ctrl){var opts=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];var startType=document.documentElement.classList.contains("no-touch")?"mousedown":"click";var endType="mouseup";tapStart=function(e){ctrl.start(e,ctrl,opts)};tapEnd=function(e){ctrl.stop(e,ctrl,opts)};el.addEventListener(startType,tapStart,false);el.addEventListener(endType,tapEnd,false);tapListeners=[{type:startType,listener:tapStart},{type:endType,listener:tapEnd}]};var clearTapEvents=function clearTapEvents(el){tapListeners.map(function(o){el.removeEventListener(o.type,o.listener,false)});tapListeners=[]};var createView=function createView(ctrl){var opts=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];if(opts.disabled){return(0,_mithril2["default"])("")}var initRipple=function initRipple(ripple,inited,context){if(inited){return}ctrl.ripple(ripple);initTapEvents(ripple,ctrl,opts);context.onunload=function(){clearTapEvents(ripple)}};var initWaves=function initWaves(waves,inited){if(inited){return}ctrl.waves(waves)};var tag=opts.tag||"div.fit";var props={"class":["ripple",opts.constrained!==false?"constrained":null,opts["class"]].join(" "),config:initRipple};var content=(0,_mithril2["default"])(".ripple-mask",(0,_mithril2["default"])(".ripple-waves",{config:initWaves}));return(0,_mithril2["default"])(tag,props,content)};var component={controller:function controller(){return{ripple:_mithril2["default"].prop(),waves:_mithril2["default"].prop(),delegate:_mithril2["default"].prop(),start:function start(e,ctrl){var opts=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];var el=ctrl.ripple();var wavesEl=ctrl.waves();var w=el.offsetWidth;var h=el.offsetHeight;var waveRadius=Math.sqrt(w*w+h*h);var rect=el.getBoundingClientRect();var mx=opts.center?rect.left+rect.width/2:e.clientX;var my=opts.center?rect.top+rect.height/2:e.clientY;var rx=mx-rect.left-waveRadius/2;var ry=my-rect.top-waveRadius/2;var initialOpacity=opts.initialOpacity!==undefined?opts.initialOpacity:DEFAULT_START_OPACITY;var opacityDecayVelocity=opts.opacityDecayVelocity!==undefined?opts.opacityDecayVelocity:OPACITY_DECAY_VELOCITY;var duration=1/opacityDecayVelocity*initialOpacity;var color=window.getComputedStyle(el).color;var transitionEvent=_polythenePolythenePolythene2["default"].whichTransitionEvent();var onEnd=function onEnd(evt){wavesEl.classList.remove("animated");wavesEl.removeEventListener(transitionEvent,onEnd,false);if(opts.end){opts.end(evt)}};wavesEl.classList.remove("animated");wavesEl.style.width=wavesEl.style.height=waveRadius+"px";wavesEl.style.top=ry+"px";wavesEl.style.left=rx+"px";wavesEl.style["animation-duration"]=wavesEl.style["-webkit-animation-duration"]=wavesEl.style["-moz-animation-duration"]=wavesEl.style["-o-animation-duration"]=duration+"s";wavesEl.style.backgroundColor=color;wavesEl.style.opacity=initialOpacity;wavesEl.addEventListener(transitionEvent,onEnd,false);if(opts.start){opts.start(e)}wavesEl.classList.add("animated")},stop:function stop(){}}},view:function view(ctrl){var opts=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];return createView(ctrl,opts)}};exports["default"]=component;module.exports=exports["default"];