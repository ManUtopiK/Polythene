"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var _polythenePolythenePolythene=require("polythene/polythene/polythene");var _polythenePolythenePolythene2=_interopRequireDefault(_polythenePolythenePolythene);var _mithril=require("mithril");var _mithril2=_interopRequireDefault(_mithril);require("polythene-theme/svg/svg");var PLUGIN_EXTENSION="!text";var globalCache={};var getPath=function getPath(){var opts=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var components=["polythene/deps/svg"];components.push(opts.iconSet||_polythenePolythenePolythene2["default"].iconSet());if(opts.group){components.push(opts.group)}if(opts.name){components.push(opts.name)}return components.join("/")+".svg"};var createView=function createView(ctrl){var opts=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var content=undefined,svg=undefined;var tag=opts.tag||"div";var props={"class":["svg",opts["class"]].join(" "),config:opts.config};var path=opts.src?opts.src:getPath(opts);if(ctrl.path()!==path){svg=globalCache[path];if(svg){content=_mithril2["default"].trust(svg);preloadNext(ctrl)}else{ctrl.path(path);loadSvg(path,ctrl)}}else{svg=ctrl.svg();svg=svg||"";content=_mithril2["default"].trust(svg);preloadNext(ctrl)}return(0,_mithril2["default"])(tag,props,_polythenePolythenePolythene2["default"].insertContent(content,opts))};var loadSvg=function loadSvg(path,ctrl){var preload=arguments.length<=2||arguments[2]===undefined?false:arguments[2];var requireUrl=path+PLUGIN_EXTENSION;var deferred=_mithril2["default"].deferred();System["import"](requireUrl).then(function(data){deferred.resolve(data);if(preload){globalCache[path]=data;ctrl.preloadingIndex++}else{ctrl.svg(data);_mithril2["default"].redraw()}})};var preloadNext=function preloadNext(ctrl){if(!ctrl.preloadingItems){return}if(ctrl.preloadingIndex>=ctrl.preloadingItems.length){return}var next=ctrl.preloadingItems[ctrl.preloadingIndex];var path=next.src?next.src:getPath(next);if(globalCache[path]){return}loadSvg(path,ctrl,true)};var component={controller:function controller(){var opts=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];return{path:_mithril2["default"].prop(""),svg:_mithril2["default"].prop(""),preloadingItems:opts.preload,preloadingIndex:0}},view:function view(ctrl){var opts=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];return createView(ctrl,opts)}};exports["default"]=component;module.exports=exports["default"];